---
title: "Visualization"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

# Introduction to Visualization in R
```{r}
df <- read.csv("./datasets/DOT1L.csv", row.names=1)

#overlay plots using legend() function
plot(df$GSM2495022[1:100], 
     main="GSM2495022 and GSM2495029",
     xlab="position",
     ylab="value",
     type="l",
     col="blue")
lines(df$GSM2495029[202:300], type="p")
legend("topleft", c("GSM2495022", "GSM2495029"), fill=c("blue", "black"))

#stacked barplots
data(mtcars)
counts <- table(mtcars$vs, mtcars$gear)
barplot(counts, main="Car Distribution by Gears and VS",
        xlab="Number of Gears", col=c("darkblue","red"),
        legend = rownames(counts))

#histograms
hist( x = df$GSM2495022,
      main = "GSM2495022's Histogram", # title of the plot
      xlab = "values",                 # set the x-axis label
      density = 10,                    # draw diagonal lines to shade the bars: 10 per inch.
                                       # By default is angle = 45Â°
      angle = 40,                      # set the angle of the shading lines is 4 degrees
      border = "gray20",               # set the colour of the borders of the bars
      col = "gray80",                  # set the colour of the shading lines
      labels = TRUE,                   # add a number just above each bar, that number
                                       # being the exact number of observations in the bin
      ylim = c(0,2900)                 # change the scale of the y-axis
)

#boxplot
boxplot( x = df$GSM2495021,   # the data
         ylab = "GSM2495021", # x-axis label
         xlab = "values",     # y-axis label
         border = "grey50",   # dim the border of the box
         frame.plot = FALSE,  # don't draw a frame
         staplewex = 0,       # don't draw staples
         whisklty = 1 ,       # solid line for whisker
         horizontal = T
)
```

# Saving Image Files in R

1. decide on output format (format(filename))
2. argument for device function is the name of the file  (ex. jpeg("rplot.jpeg"))
3. plotting commands
4. dev.off()

# Introduction to ggplot

- takes a data frame as an object
- must have at least on geom
- functions are chained together using +
- themes fine tune the appearance of the graph
- ggplot graph is saved as a named R object

```{r}
new_metadata <- read.csv("./datasets/new_metadata.csv")
ggplot(new_metadata)+
  geom_point(aes(x=age_in_days, y=samplemeans, color=genotype, shape=celltype), size=3.0)+
  theme_bw()+
  theme(axis.text=element_text(size=rel(1.5)),
        axis.title=element_text(size=rel(1.5)))
```

### 1.  The current axis label text defaults to what we gave as input to geom_point (i.e the column headers). We can change this by adding additional layers called xlab() and ylab() for the x- and y-axis, respectively. Add these layers to the current plot such that the x-axis is labeled "Age (days)" and the y-axis is labeled "Mean expression".
```{r}
new_metadata <- read.csv("./datasets/new_metadata.csv")
ggplot(new_metadata)+
  geom_point(aes(x=age_in_days, y=samplemeans, color=genotype, shape=celltype), size=3.0)+
  theme_bw()+
  theme(axis.text=element_text(size=rel(1.5)),
        axis.title=element_text(size=rel(1.5)))+
  xlab("Age(days)")+ ylab("Mean Expression")
```

### 2. Use the ggtitle layer to add a title to your plot. NOTE: Useful code to center your title over your plot can be done using theme(plot.title=element_text(hjust=0.5)).
```{r}
new_metadata <- read.csv("./datasets/new_metadata.csv")
ggplot(new_metadata)+
  geom_point(aes(x=age_in_days, y=samplemeans, color=genotype, shape=celltype), size=3.0)+
  theme_bw()+
  theme(axis.text=element_text(size=rel(1.5)),
        axis.title=element_text(size=rel(1.5)),
        plot.title=element_text(hjust=0.5))+
  xlab("Age(days)")+ ylab("Mean Expression")+
  ggtitle("Gene Expression Over Time")
```

# Boxplots
```{r}
ggplot(new_metadata)+
  geom_boxplot(aes(x=genotype, y=samplemeans, fill=celltype))+
  theme_bw()+
  theme(axis.text=element_text(size=rel(1.25)),
        axis.title=element_text(size=rel(1.5)),
        plot.title=element_text(size=rel(1.5)))+
  xlab("Genotype")+ ylab("Mean Expression")
```

# Volcano Plots

Type of scatter plot that shows statistical significance (p-value) vs. magnitude of change (fold change)

```{r}
library(EnhancedVolcano)
df <- read.csv("./datasets/DOT1L.csv", row.names=1)
rownames(df) <- df$ID
volcano_plot <- EnhancedVolcano(df,
                                lab=rownames(df),
                                pCutoff=0.05,
                                FCcutoff=0.5,
                                x="logFC",
                                y="adj.P.Val",
                                pointSize=1,
                                legendLabSize=10,
                                xlim=c(-3,3),
                                ylim=c(0,7),
                                labSize=3.0)
volcano_plot
```
